<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="theme-color" content="#4F46E5">
    <meta name="description" content="Inteligencia espiritual y mental avanzada para coherencia integral">
    <title>Coherencia Integrada</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: linear-gradient(135deg, #0F172A 0%, #1E293B 100%);
            color: #F1F5F9;
            min-height: 100vh;
            overflow-x: hidden;
            padding-bottom: 80px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            text-align: center;
            padding: 40px 20px;
            background: linear-gradient(135deg, rgba(79, 70, 229, 0.2), rgba(139, 92, 246, 0.2));
            border-radius: 20px;
            margin-bottom: 30px;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            background: linear-gradient(135deg, #818CF8, #A78BFA);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .header p {
            color: #CBD5E1;
            font-size: 1.1rem;
        }

        .theme-toggle, .tutorial-btn {
            position: fixed;
            top: 20px;
            z-index: 1000;
            background: rgba(79, 70, 229, 0.3);
            border: 2px solid #4F46E5;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            font-size: 1.5rem;
            transition: all 0.3s ease;
        }

        .theme-toggle {
            right: 20px;
        }

        .tutorial-btn {
            left: 20px;
            background: linear-gradient(135deg, #F59E0B, #D97706);
            border-color: #F59E0B;
        }

        .theme-toggle:hover {
            transform: rotate(180deg);
            background: rgba(79, 70, 229, 0.5);
        }

        .tutorial-btn:hover {
            transform: scale(1.1);
            box-shadow: 0 6px 25px rgba(245, 158, 11, 0.6);
        }

        .areas-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .area-card {
            background: rgba(30, 41, 59, 0.8);
            border-radius: 15px;
            padding: 20px;
            border: 2px solid transparent;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .area-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: var(--color);
            transform: scaleX(0);
            transition: transform 0.3s ease;
        }

        .area-card:hover::before,
        .area-card.active::before {
            transform: scaleX(1);
        }

        .area-card:hover,
        .area-card.active {
            border-color: var(--color);
            transform: translateY(-5px);
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
        }

        .area-icon {
            font-size: 2.5rem;
            margin-bottom: 10px;
        }

        .area-title {
            font-size: 1.2rem;
            font-weight: 600;
            margin-bottom: 5px;
            color: #F1F5F9;
        }

        .area-level {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-top: 15px;
        }

        .level-bar {
            flex: 1;
            height: 6px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 3px;
            overflow: hidden;
        }

        .level-fill {
            height: 100%;
            background: var(--color);
            border-radius: 3px;
            transition: width 0.5s ease;
        }

        .level-adjuster {
            display: flex;
            gap: 5px;
            margin-top: 10px;
        }

        .level-btn {
            background: rgba(79, 70, 229, 0.2);
            border: 1px solid var(--color);
            color: var(--color);
            border-radius: 5px;
            padding: 5px 10px;
            cursor: pointer;
            font-size: 0.9rem;
            transition: all 0.2s ease;
        }

        .level-btn:hover {
            background: rgba(79, 70, 229, 0.4);
        }

        .input-section {
            background: rgba(30, 41, 59, 0.8);
            border-radius: 15px;
            padding: 30px;
            margin-bottom: 30px;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .input-section h2 {
            color: #A78BFA;
            margin-bottom: 20px;
            font-size: 1.5rem;
        }

        textarea {
            width: 100%;
            min-height: 120px;
            padding: 15px;
            background: rgba(15, 23, 42, 0.8);
            border: 2px solid rgba(139, 92, 246, 0.3);
            border-radius: 10px;
            color: #F1F5F9;
            font-size: 1rem;
            resize: vertical;
            font-family: inherit;
            transition: border-color 0.3s ease;
        }

        textarea:focus {
            outline: none;
            border-color: #8B5CF6;
        }

        textarea::placeholder {
            color: #64748B;
        }

        .btn-analyze {
            width: 100%;
            padding: 15px;
            background: linear-gradient(135deg, #4F46E5, #8B5CF6);
            color: white;
            border: none;
            border-radius: 10px;
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            margin-top: 15px;
            transition: all 0.3s ease;
        }

        .btn-analyze:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(139, 92, 246, 0.4);
        }

        .results-section {
            background: rgba(30, 41, 59, 0.8);
            border-radius: 15px;
            padding: 30px;
            margin-bottom: 30px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            display: none;
        }

        .results-section.active {
            display: block;
            animation: slideIn 0.5s ease;
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        @keyframes fadeOut {
            from { opacity: 1; }
            to { opacity: 0; }
        }

        .command-box {
            background: linear-gradient(135deg, rgba(79, 70, 229, 0.2), rgba(139, 92, 246, 0.2));
            padding: 25px;
            border-radius: 12px;
            margin-bottom: 25px;
            border-left: 4px solid #8B5CF6;
        }

        .command-box h3 {
            color: #A78BFA;
            margin-bottom: 15px;
            font-size: 1.3rem;
        }

        .command-text {
            font-size: 1.2rem;
            line-height: 1.6;
            color: #E2E8F0;
            font-weight: 500;
        }

        .actions-list {
            list-style: none;
            margin-top: 15px;
        }

        .actions-list li {
            padding: 12px 15px;
            margin-bottom: 10px;
            background: rgba(15, 23, 42, 0.6);
            border-radius: 8px;
            border-left: 3px solid var(--color);
        }

        .coherence-indicator {
            display: flex;
            align-items: center;
            gap: 15px;
            padding: 20px;
            background: rgba(15, 23, 42, 0.6);
            border-radius: 10px;
            margin-top: 20px;
        }

        .coherence-circle {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            font-weight: bold;
            position: relative;
            background: rgba(15, 23, 42, 0.8);
        }

        .coherence-circle::before {
            content: '';
            position: absolute;
            inset: -5px;
            border-radius: 50%;
            padding: 5px;
            background: conic-gradient(var(--color) var(--percentage), rgba(255, 255, 255, 0.1) var(--percentage));
            -webkit-mask: linear-gradient(#fff 0 0) content-box, linear-gradient(#fff 0 0);
            -webkit-mask-composite: xor;
            mask-composite: exclude;
        }

        .quick-actions {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            margin-top: 15px;
        }

        .quick-btn {
            padding: 10px 20px;
            background: rgba(79, 70, 229, 0.2);
            border: 1px solid #4F46E5;
            border-radius: 20px;
            color: #A78BFA;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 0.9rem;
        }

        .quick-btn:hover {
            background: rgba(79, 70, 229, 0.4);
            transform: translateY(-2px);
        }
        
        .hidden-text {
            display: none !important;
            visibility: hidden !important;
        }

        .tools-panel {
            position: fixed;
            bottom: 20px;
            right: 20px;
            z-index: 999;
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .tool-btn {
            padding: 12px 20px;
            background: linear-gradient(135deg, #4F46E5, #8B5CF6);
            color: white;
            border: none;
            border-radius: 25px;
            font-size: 1rem;
            cursor: pointer;
            box-shadow: 0 4px 15px rgba(139, 92, 246, 0.3);
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 8px;
            white-space: nowrap;
        }

        .tool-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 20px rgba(139, 92, 246, 0.5);
        }

        .modal {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(15, 23, 42, 0.95);
            z-index: 1000;
            display: none;
            align-items: center;
            justify-content: center;
            overflow-y: auto;
            padding: 20px;
            animation: fadeIn 0.3s ease;
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background: rgba(30, 41, 59, 0.95);
            padding: 40px;
            border-radius: 20px;
            max-width: 700px;
            width: 100%;
            border: 1px solid rgba(139, 92, 246, 0.3);
            max-height: 90vh;
            overflow-y: auto;
        }

        .modal h2 {
            color: #A78BFA;
            font-size: 2rem;
            margin-bottom: 30px;
            text-align: center;
        }

        .modal-input {
            margin-bottom: 25px;
        }

        .modal-input label {
            color: #CBD5E1;
            font-size: 1.1rem;
            display: block;
            margin-bottom: 10px;
        }

        .modal-input textarea, .modal-input input, .modal-input select {
            width: 100%;
            padding: 12px 15px;
            background: rgba(15, 23, 42, 0.8);
            border: 2px solid rgba(139, 92, 246, 0.3);
            border-radius: 8px;
            color: #F1F5F9;
            font-size: 1rem;
            font-family: inherit;
        }

        .modal-input textarea {
            min-height: 80px;
            resize: vertical;
        }

        .modal-input input:focus, .modal-input textarea:focus, .modal-input select:focus {
            outline: none;
            border-color: #8B5CF6;
        }

        .modal-buttons {
            display: flex;
            gap: 15px;
            margin-top: 30px;
        }

        .btn-primary {
            flex: 1;
            padding: 15px;
            background: linear-gradient(135deg, #4F46E5, #8B5CF6);
            color: white;
            border: none;
            border-radius: 10px;
            font-size: 1.1rem;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(139, 92, 246, 0.4);
        }

        .btn-secondary {
            padding: 15px 30px;
            background: rgba(139, 92, 246, 0.2);
            border: 2px solid #8B5CF6;
            border-radius: 10px;
            color: #A78BFA;
            cursor: pointer;
            font-size: 1.1rem;
            transition: all 0.3s ease;
        }

        .btn-secondary:hover {
            background: rgba(139, 92, 246, 0.3);
        }

        .meditation-container {
            text-align: center;
            padding: 40px;
        }

        .meditation-phase {
            font-size: 1.5rem;
            color: #E2E8F0;
            margin: 40px 0;
            min-height: 40px;
        }

        .breath-circle {
            width: 200px;
            height: 200px;
            margin: 40px auto;
            border-radius: 50%;
            background: linear-gradient(135deg, #4F46E5, #8B5CF6);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 3rem;
            transition: transform 1s ease-in-out;
            box-shadow: 0 0 40px rgba(139, 92, 246, 0.5);
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: rgba(15, 23, 42, 0.6);
            padding: 20px;
            border-radius: 12px;
            border-left: 4px solid var(--color);
        }

        .stat-label {
            color: #94A3B8;
            margin-bottom: 5px;
            font-size: 0.9rem;
        }

        .stat-value {
            font-size: 2rem;
            color: var(--color);
            font-weight: bold;
        }

        .reminder-section {
            background: rgba(15, 23, 42, 0.6);
            padding: 20px;
            border-radius: 12px;
            margin-top: 20px;
        }

        .reminder-input {
            display: flex;
            gap: 10px;
            margin-top: 15px;
            flex-wrap: wrap;
        }

        .reminder-input input {
            flex: 1;
            min-width: 150px;
        }

        .reminder-list {
            list-style: none;
            margin-top: 15px;
        }

        .reminder-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px 15px;
            background: rgba(30, 41, 59, 0.6);
            border-radius: 8px;
            margin-bottom: 10px;
            flex-wrap: wrap;
            gap: 10px;
        }

        .reminder-delete {
            background: rgba(239, 68, 68, 0.2);
            border: 1px solid #EF4444;
            color: #EF4444;
            padding: 5px 12px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 0.85rem;
            transition: all 0.2s ease;
        }

        .reminder-delete:hover {
            background: rgba(239, 68, 68, 0.4);
        }

        body.light-mode {
            background: linear-gradient(135deg, #F1F5F9 0%, #E2E8F0 100%);
            color: #1E293B;
        }

        body.light-mode .header,
        body.light-mode .input-section,
        body.light-mode .results-section,
        body.light-mode .area-card,
        body.light-mode .modal-content {
            background: rgba(255, 255, 255, 0.9);
            color: #1E293B;
        }

        body.light-mode .header h1 {
            background: linear-gradient(135deg, #4F46E5, #8B5CF6);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        body.light-mode textarea, 
        body.light-mode .modal-input input,
        body.light-mode .modal-input select {
            background: rgba(241, 245, 249, 0.8);
            color: #1E293B;
        }

        body.light-mode .command-text,
        body.light-mode .area-title {
            color: #1E293B;
        }

        #tutorialOverlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.8);
            z-index: 9999;
            display: none;
            pointer-events: none;
        }

        #tutorialOverlay.active {
            display: block;
        }

        #tutorialHighlight {
            position: absolute;
            border: 3px solid #F59E0B;
            border-radius: 10px;
            box-shadow: 0 0 0 9999px rgba(0, 0, 0, 0.7), 0 0 30px #F59E0B;
            transition: all 0.5s ease;
            pointer-events: none;
        }

        #tutorialTooltip {
            position: absolute;
            background: linear-gradient(135deg, #1E293B, #334155);
            padding: 20px;
            border-radius: 15px;
            border: 2px solid #F59E0B;
            max-width: 400px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.5);
            pointer-events: auto;
        }

        #tutorialTooltipContent {
            color: #F1F5F9;
            line-height: 1.6;
        }

        @media (max-width: 768px) {
            .header h1 {
                font-size: 1.8rem;
            }
            
            .areas-grid {
                grid-template-columns: 1fr;
            }

            .tools-panel {
                bottom: 10px;
                right: 10px;
            }

            .tool-btn {
                font-size: 0.9rem;
                padding: 10px 15px;
            }

            .stats-grid {
                grid-template-columns: 1fr;
            }

            .modal-content {
                padding: 20px;
            }

            .tutorial-btn, .theme-toggle {
                width: 45px;
                height: 45px;
                font-size: 1.3rem;
            }
        }
    </style>
</head>
<body>
    <div class="theme-toggle" id="themeToggle">🌙</div>
    
    <button class="tutorial-btn" id="tutorialBtn">📚</button>

    <div class="container">
        <div class="header">
            <h1>🧠✨ Sistema de Coherencia Integrada</h1>
            <p>Inteligencia espiritual y mental avanzada a tu servicio</p>
        </div>

        <div class="areas-grid" id="areasGrid"></div>

        <div class="input-section">
            <h2>💭 Comparte tu estado actual</h2>
            <textarea id="userInput" placeholder="Escribe aquí tus pensamientos, emociones, situaciones o decisiones que necesites clarificar...&#10;&#10;Ejemplos:&#10;• Siento ansiedad sobre mi proyecto laboral&#10;• No tengo energía y mi casa está desordenada&#10;• Necesito decidir sobre un cambio de carrera&#10;• ¿Qué debo atender hoy?"></textarea>
            
            <div class="quick-actions">
                <button class="quick-btn" data-text="¿Qué necesito atender hoy?">¿Qué atender hoy?</button>
                <button class="quick-btn" data-text="Me siento disperso y sin dirección">Estado disperso</button>
                <button class="quick-btn" data-text="Tengo una decisión importante que tomar">Decisión importante</button>
                <button class="quick-btn" data-text="Necesito equilibrar mi energía">Equilibrar energía</button>
            </div>

            <button class="btn-analyze" id="analyzeBtn">⚡ Traducir a Comandos Claros</button>
        </div>

        <div class="results-section" id="resultsSection">
            <div class="command-box">
                <h3>🎯 Comando Central</h3>
                <div class="command-text" id="commandText"></div>
            </div>

            <div class="command-box">
                <h3>📊 Diagnóstico del Estado Actual</h3>
                <div id="diagnosisText"></div>
            </div>

            <div class="command-box">
                <h3>⚡ Acciones Específicas por Área</h3>
                <ul class="actions-list" id="actionsList"></ul>
            </div>

            <div class="coherence-indicator">
                <div class="coherence-circle" id="coherenceCircle">
                    <span>0%</span>
                </div>
                <div>
                    <strong style="color: #A78BFA;">Indicador de Coherencia</strong>
                    <p style="color: #94A3B8; margin-top: 5px;" id="coherenceText"></p>
                </div>
            </div>

            <div class="command-box">
                <h3>✓ Verificación</h3>
                <div id="verificationText"></div>
            </div>
        </div>
    </div>

    <div class="tools-panel">
        <button class="tool-btn" id="meditationBtn">
            <span>🧘</span>
            <span>Meditación</span>
        </button>
        <button class="tool-btn" id="journalBtn">
            <span>📔</span>
            <span>Diario</span>
        </button>
        <button class="tool-btn" id="statsBtn">
            <span>📊</span>
            <span>Estadísticas</span>
        </button>
        <button class="tool-btn" id="remindersBtn">
            <span>⏰</span>
            <span>Recordatorios</span>
        </button>
        <button class="tool-btn" id="commandsBtn">
            <span>🗣️</span>
            <span>Comandos</span>
        </button>
    </div>

    <!-- Modal Meditación -->
    <div class="modal" id="meditationModal">
        <div class="meditation-container">
            <h2>🧘 Meditación de Coherencia</h2>
            <div class="meditation-phase" id="meditationPhase">Prepárate para comenzar...</div>
            <div class="breath-circle" id="breathCircle">🫁</div>
            <button class="btn-secondary" id="closeMeditationBtn">Finalizar</button>
        </div>
    </div>

    <!-- Modal Diario -->
    <div class="modal" id="journalModal">
        <div class="modal-content">
            <h2>📔 Diario de Coherencia</h2>
            
            <div class="modal-input">
                <label>3 cosas por las que estoy agradecido hoy:</label>
                <textarea id="gratitude"></textarea>
            </div>
            
            <div class="modal-input">
                <label>¿Qué aprendí hoy?</label>
                <textarea id="learning"></textarea>
            </div>
            
            <div class="modal-input">
                <label>Mi intención para mañana:</label>
                <textarea id="intention"></textarea>
            </div>
            
            <div class="modal-buttons">
                <button class="btn-primary" id="saveJournalBtn">💾 Guardar</button>
                <button class="btn-secondary" id="closeJournalBtn">Cerrar</button>
            </div>
        </div>
    </div>

    <!-- Modal Estadísticas -->
    <div class="modal" id="statsModal">
        <div class="modal-content">
            <h2>📊 Panel de Coherencia</h2>
            
            <div class="stats-grid" id="statsGrid"></div>
            
            <div style="background: rgba(15, 23, 42, 0.6); padding: 25px; border-radius: 12px; margin-bottom: 20px;">
                <h3 style="color: #A78BFA; margin-bottom: 15px; font-size: 1.3rem;">💡 Recomendación Inteligente</h3>
                <p id="recommendation" style="color: #E2E8F0; line-height: 1.6;"></p>
            </div>
            
            <button class="btn-secondary" style="width: 100%;" id="closeStatsBtn">Cerrar</button>
        </div>
    </div>

    <!-- Modal Recordatorios -->
    <div class="modal" id="remindersModal">
        <div class="modal-content">
            <h2>⏰ Recordatorios Inteligentes</h2>
            
            <div class="reminder-section">
                <h3 style="color: #A78BFA; margin-bottom: 15px;">Agregar nuevo recordatorio</h3>
                <div class="reminder-input">
                    <input type="time" id="reminderTime" value="09:00">
                    <input type="text" id="reminderText" placeholder="Ej: Revisar mi coherencia diaria">
                    <button class="btn-primary" id="addReminderBtn">Agregar</button>
                </div>
            </div>

            <div class="reminder-section">
                <h3 style="color: #A78BFA; margin-bottom: 15px;">Mis recordatorios</h3>
                <ul class="reminder-list" id="reminderList"></ul>
            </div>
            
            <button class="btn-secondary" style="width: 100%; margin-top: 20px;" id="closeRemindersBtn">Cerrar</button>
        </div>
    </div>

    <!-- Modal Comandos Verbales -->
    <div class="modal" id="affirmationsModal">
        <div class="modal-content" style="max-width: 900px;">
            <h2>🗣️ Comandos Verbales de Coherencia</h2>
            
            <div style="background: linear-gradient(135deg, rgba(79, 70, 229, 0.2), rgba(139, 92, 246, 0.2)); padding: 20px; border-radius: 12px; margin-bottom: 25px;">
                <h3 style="color: #A78BFA; margin-bottom: 10px;">💡 Fórmula para Crear Comandos Poderosos</h3>
                <p style="color: #E2E8F0; line-height: 1.6; margin-bottom: 15px;">
                    <strong>Estructura:</strong> [ORDEN DIRECTA] + [ESTADO DESEADO] + [TIEMPO PRESENTE] + [AUTORIDAD]
                </p>
                <div style="background: rgba(15, 23, 42, 0.6); padding: 15px; border-radius: 8px; font-family: monospace; color: #A78BFA;">
                    "Mi [sistema/cuerpo/mente] AHORA [acción específica]. Esto es [verdad absoluta]. Así es."
                </div>
                <p style="color: #CBD5E1; margin-top: 10px; font-size: 0.95rem;">
                    <strong>Claves:</strong> Tiempo presente, autoridad declarativa, específico, sin negaciones
                </p>
            </div>

            <div style="margin-bottom: 20px;">
                <h3 style="color: #A78BFA; margin-bottom: 15px;">📋 Comandos por Área</h3>
                <div id="affirmationsGrid" style="display: grid; gap: 15px;"></div>
            </div>

            <div class="reminder-section">
                <h3 style="color: #A78BFA; margin-bottom: 15px;">➕ Crear Comando Personalizado</h3>
                <div style="margin-bottom: 15px;">
                    <label style="color: #CBD5E1; display: block; margin-bottom: 8px;">Área:</label>
                    <select id="customCommandArea" style="width: 100%; padding: 12px; background: rgba(15, 23, 42, 0.8); border: 2px solid rgba(139, 92, 246, 0.3); border-radius: 8px; color: #F1F5F9; font-size: 1rem;">
                        <option value="spiritual">🕉️ Espiritual</option>
                        <option value="health">💪 Cuerpo/Salud</option>
                        <option value="family">👨‍👩‍👧 Familia</option>
                        <option value="career">💼 Profesión/Finanzas</option>
                        <option value="study">📚 Estudio Personal</option>
                        <option value="recreation">🎨 ReCreación</option>
                        <option value="home">🏡 Casa/Espacio</option>
                        <option value="social">🤝 Social/Relaciones</option>
                    </select>
                </div>
                <div style="margin-bottom: 15px;">
                    <label style="color: #CBD5E1; display: block; margin-bottom: 8px;">Tu Comando Verbal:</label>
                    <textarea id="customCommandText" placeholder="Ejemplo: Mi cuerpo AHORA libera toda tensión acumulada. Cada célula se relaja y regenera. Esto es verdad. Así es." style="width: 100%; min-height: 100px;"></textarea>
                </div>
                <button class="btn-primary" id="addCustomCommandBtn">➕ Agregar Comando</button>
            </div>
            
            <button class="btn-secondary" style="width: 100%; margin-top: 20px;" id="closeAffirmationsBtn">Cerrar</button>
        </div>
    </div>

    <!-- Modal Tutorial -->
    <div class="modal" id="tutorialModal">
        <div class="modal-content" style="max-width: 800px;">
            <div id="tutorialContent"></div>
            <div style="display: flex; gap: 15px; margin-top: 30px; justify-content: space-between; flex-wrap: wrap;">
                <button class="btn-secondary" id="tutorialPrev" style="display: none;">← Anterior</button>
                <button class="btn-primary" id="tutorialNext">Siguiente →</button>
                <button class="btn-secondary" id="closeTutorialBtn">Salir</button>
            </div>
            <div style="text-align: center; margin-top: 15px; color: #94A3B8;">
                <span id="tutorialProgress"></span>
            </div>
        </div>
    </div>

    <!-- Overlay Tutorial Interactivo -->
    <div id="tutorialOverlay">
        <div id="tutorialHighlight"></div>
        <div id="tutorialTooltip">
            <div id="tutorialTooltipContent"></div>
            <div style="display: flex; gap: 10px; margin-top: 15px;">
                <button id="skipTutorialBtn" style="flex: 1; padding: 10px; background: rgba(239, 68, 68, 0.2); border: 2px solid #EF4444; color: #EF4444; border-radius: 8px; cursor: pointer;">Saltar</button>
                <button id="nextTutorialBtn" style="flex: 2; padding: 10px; background: linear-gradient(135deg, #F59E0B, #D97706); color: white; border: none; border-radius: 8px; cursor: pointer; font-weight: 600;">Entendido →</button>
            </div>
        </div>
    </div>

    <script>
        // Prevent any inline code from showing
        document.addEventListener('DOMContentLoaded', function() {
            // Remove any text nodes that contain code
            const walker = document.createTreeWalker(
                document.body,
                NodeFilter.SHOW_TEXT,
                null,
                false
            );
            
            const nodesToRemove = [];
            let node;
            
            while (node = walker.nextNode()) {
                const text = node.textContent.trim();
                if (text.includes('function') || text.includes('onclick') || text.includes('lowerInput')) {
                    nodesToRemove.push(node);
                }
            }
            
            nodesToRemove.forEach(node => {
                if (node.parentNode) {
                    node.parentNode.removeChild(node);
                }
            });
        });
        // Data structure
        const appData = {
            areas: [
                { id: 'spiritual', icon: '🕉️', title: 'Espiritual', color: '#8B5CF6', level: 70, description: 'Propósito, valores, conexión interna' },
                { id: 'health', icon: '💪', title: 'Cuerpo/Salud', color: '#10B981', level: 65, description: 'Energía física, nutrición, descanso' },
                { id: 'family', icon: '👨‍👩‍👧', title: 'Familia', color: '#F59E0B', level: 80, description: 'Vínculos primarios, amor' },
                { id: 'career', icon: '💼', title: 'Profesión/Finanzas', color: '#3B82F6', level: 60, description: 'Aporte, recursos, estabilidad' },
                { id: 'study', icon: '📚', title: 'Estudio Personal', color: '#06B6D4', level: 55, description: 'Aprendizaje, expansión mental' },
                { id: 'recreation', icon: '🎨', title: 'ReCreación', color: '#EC4899', level: 50, description: 'Disfrute, renovación' },
                { id: 'home', icon: '🏡', title: 'Casa/Espacio', color: '#84CC16', level: 45, description: 'Orden físico, ambiente' },
                { id: 'social', icon: '🤝', title: 'Social/Relaciones', color: '#F97316', level: 75, description: 'Comunidad, conexiones' }
            ],
            reminders: [],
            journalEntries: [],
            theme: 'dark',
            verbalCommands: {
                spiritual: [
                    "Mi conciencia AHORA se expande hacia mi propósito más elevado. Estoy alineado con mi verdad interior. Así es.",
                    "Cada respiración me conecta con la fuente infinita de sabiduría. Soy guía de mi propio camino. Esto es verdad.",
                    "Mi espíritu se eleva por encima de la ilusión. Veo con claridad mi misión en este momento. Así es."
                ],
                health: [
                    "Mi cuerpo AHORA libera toda tensión acumulada. Cada célula se relaja y regenera. Esto es verdad. Así es.",
                    "Mi energía vital fluye libremente por todo mi ser. Soy fuerza, soy vitalidad, soy salud perfecta. Así es.",
                    "Ordeno a mi sistema nervioso: CALMA TOTAL. Mi cuerpo obedece. Estoy en equilibrio perfecto. Así es."
                ],
                family: [
                    "Mi amor fluye sin obstáculos hacia mis seres queridos. Soy presencia pura para mi familia. Así es.",
                    "Cada palabra que pronuncio fortalece los vínculos sagrados. Soy ancla de paz en mi hogar. Esto es verdad.",
                    "Mi corazón AHORA se abre completamente. Doy y recibo amor sin condiciones. Así es."
                ],
                career: [
                    "Mi valor se multiplica en cada acción que tomo. Soy abundancia generando abundancia. Así es.",
                    "Cada proyecto que toco se transforma en éxito. Mis recursos se expanden constantemente. Esto es verdad.",
                    "Mi trabajo AHORA sirve al mundo y me retorna prosperidad. Soy creador de valor infinito. Así es."
                ],
                study: [
                    "Mi mente AHORA absorbe conocimiento como esponja en agua. Aprendo con facilidad y gozo. Así es.",
                    "Cada concepto que estudio se integra perfectamente en mi sabiduría. Soy estudiante maestro. Esto es verdad.",
                    "Mi capacidad de aprender se expande sin límites. Soy mente brillante en evolución constante. Así es."
                ],
                recreation: [
                    "Ahora me permito disfrutar plenamente este momento. Soy merecedor de placer y descanso. Así es.",
                    "Mi creatividad fluye sin esfuerzo. Soy expresión pura de alegría y renovación. Esto es verdad.",
                    "Cada instante de juego recarga mi alma. Soy ser en balance perfecto entre acción y reposo. Así es."
                ],
                home: [
                    "Mi espacio AHORA refleja la claridad de mi mente. Orden externo, orden interno. Así es.",
                    "Cada objeto en mi hogar tiene su lugar perfecto. Soy arquitecto de mi santuario personal. Esto es verdad.",
                    "Mi ambiente me nutre y sostiene. Soy creador de espacios de poder y paz. Así es."
                ],
                social: [
                    "Atraigo personas que elevan mi frecuencia. Soy imán de relaciones auténticas y valiosas. Así es.",
                    "Mi comunicación AHORA es clara, compasiva y poderosa. Soy puente entre corazones. Esto es verdad.",
                    "Cada conexión que hago enriquece mi vida y la del otro. Soy red de apoyo y crecimiento mutuo. Así es."
                ]
            },
            customCommands: {},
            tutorialCompleted: false,
            currentTutorialStep: 0
        };

        // Tutorial Steps
        const tutorialSteps = [
            {
                title: "🎯 Bienvenido al Sistema de Coherencia Integrada",
                content: `
                    <h3 style="color: #A78BFA; margin-bottom: 15px;">¿Qué es esta herramienta?</h3>
                    <p style="color: #E2E8F0; line-height: 1.8; margin-bottom: 15px;">
                        Esta es tu <strong>inteligencia artificial personal</strong> que traduce tus pensamientos y emociones en 
                        <strong>comandos claros y accionables</strong> para tu cerebro, cuerpo y energía vital.
                    </p>
                    <div style="background: rgba(79, 70, 229, 0.2); padding: 15px; border-radius: 10px; border-left: 4px solid #8B5CF6; margin: 15px 0;">
                        <strong style="color: #A78BFA;">🎯 Objetivo Principal:</strong><br>
                        <span style="color: #CBD5E1;">Ayudarte a pensar, sentir y actuar con coherencia, alineando tu conciencia con tu cuerpo, emociones, decisiones y entorno.</span>
                    </div>
                    <p style="color: #94A3B8; margin-top: 15px;">
                        La app funciona en <strong>8 áreas de vida</strong> y genera análisis personalizados según tu estado actual.
                    </p>
                `
            },
            {
                title: "🎨 Las 8 Áreas de Vida",
                content: `
                    <h3 style="color: #A78BFA; margin-bottom: 15px;">Tu Sistema de Coherencia Integral</h3>
                    <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 12px; margin: 20px 0;">
                        <div style="background: rgba(139, 92, 246, 0.2); padding: 12px; border-radius: 8px; border-left: 3px solid #8B5CF6;">
                            <strong style="color: #8B5CF6;">🕉️ Espiritual</strong><br>
                            <span style="color: #CBD5E1; font-size: 0.9rem;">Propósito, valores</span>
                        </div>
                        <div style="background: rgba(16, 185, 129, 0.2); padding: 12px; border-radius: 8px; border-left: 3px solid #10B981;">
                            <strong style="color: #10B981;">💪 Salud</strong><br>
                            <span style="color: #CBD5E1; font-size: 0.9rem;">Energía, nutrición</span>
                        </div>
                        <div style="background: rgba(245, 158, 11, 0.2); padding: 12px; border-radius: 8px; border-left: 3px solid #F59E0B;">
                            <strong style="color: #F59E0B;">👨‍👩‍👧 Familia</strong><br>
                            <span style="color: #CBD5E1; font-size: 0.9rem;">Vínculos, amor</span>
                        </div>
                        <div style="background: rgba(59, 130, 246, 0.2); padding: 12px; border-radius: 8px; border-left: 3px solid #3B82F6;">
                            <strong style="color: #3B82F6;">💼 Profesión</strong><br>
                            <span style="color: #CBD5E1; font-size: 0.9rem;">Recursos, aporte</span>
                        </div>
                        <div style="background: rgba(6, 182, 212, 0.2); padding: 12px; border-radius: 8px; border-left: 3px solid #06B6D4;">
                            <strong style="color: #06B6D4;">📚 Estudio</strong><br>
                            <span style="color: #CBD5E1; font-size: 0.9rem;">Aprendizaje</span>
                        </div>
                        <div style="background: rgba(236, 72, 153, 0.2); padding: 12px; border-radius: 8px; border-left: 3px solid #EC4899;">
                            <strong style="color: #EC4899;">🎨 ReCreación</strong><br>
                            <span style="color: #CBD5E1; font-size: 0.9rem;">Disfrute</span>
                        </div>
                        <div style="background: rgba(132, 204, 22, 0.2); padding: 12px; border-radius: 8px; border-left: 3px solid #84CC16;">
                            <strong style="color: #84CC16;">🏡 Casa</strong><br>
                            <span style="color: #CBD5E1; font-size: 0.9rem;">Orden físico</span>
                        </div>
                        <div style="background: rgba(249, 115, 22, 0.2); padding: 12px; border-radius: 8px; border-left: 3px solid #F97316;">
                            <strong style="color: #F97316;">🤝 Social</strong><br>
                            <span style="color: #CBD5E1; font-size: 0.9rem;">Comunidad</span>
                        </div>
                    </div>
                `
            },
            {
                title: "📝 Cómo Usar la App",
                content: `
                    <h3 style="color: #A78BFA; margin-bottom: 15px;">Flujo Diario Recomendado</h3>
                    <div style="background: rgba(15, 23, 42, 0.6); padding: 20px; border-radius: 10px;">
                        <ol style="color: #E2E8F0; line-height: 2; padding-left: 20px;">
                            <li><strong style="color: #A78BFA;">Ajusta niveles</strong> - Usa los botones +5/-5 en cada área</li>
                            <li><strong style="color: #A78BFA;">Escribe tu estado</strong> - Pensamientos, emociones, decisiones</li>
                            <li><strong style="color: #A78BFA;">Recibe comandos</strong> - El sistema analiza y te da acciones</li>
                            <li><strong style="color: #A78BFA;">Usa las herramientas</strong> - Meditación, Diario, Estadísticas</li>
                            <li><strong style="color: #A78BFA;">Pronuncia comandos</strong> - Activa tu sistema con voz</li>
                        </ol>
                    </div>
                `
            },
            {
                title: "🚀 ¡Comienza Ahora!",
                content: `
                    <h3 style="color: #A78BFA; margin-bottom: 20px; text-align: center;">Tu Primera Acción</h3>
                    <div style="background: linear-gradient(135deg, rgba(79, 70, 229, 0.3), rgba(139, 92, 246, 0.3)); padding: 25px; border-radius: 15px; text-align: center;">
                        <div style="font-size: 3rem; margin-bottom: 15px;">🎯</div>
                        <p style="color: #E2E8F0; font-size: 1.2rem; margin-bottom: 20px;">
                            <strong>Escribe en el campo de texto:</strong>
                        </p>
                        <div style="background: rgba(15, 23, 42, 0.8); padding: 20px; border-radius: 10px; border: 2px solid #8B5CF6;">
                            <p style="color: #A78BFA; font-size: 1.3rem; font-style: italic;">
                                "¿Qué necesito atender hoy?"
                            </p>
                        </div>
                    </div>
                    <div style="text-align: center; margin-top: 30px;">
                        <p style="color: #8B5CF6; font-size: 1.3rem; font-weight: 600;">
                            ¡Estás listo! 🚀
                        </p>
                    </div>
                `
            }
        ];

        // Interactive Tutorial Steps
        const interactiveTutorialSteps = [
            {
                target: '.areas-grid',
                title: 'Las 8 Áreas de Vida',
                content: 'Ajusta el nivel de cada área con los botones +5/-5 según tu estado actual.',
                position: 'bottom'
            },
            {
                target: '#userInput',
                title: 'Comparte tu Estado',
                content: 'Escribe aquí tus pensamientos o emociones para recibir comandos específicos.',
                position: 'top'
            },
            {
                target: '.tools-panel',
                title: 'Herramientas Principales',
                content: 'Explora las 5 herramientas: Meditación, Diario, Estadísticas, Recordatorios y Comandos.',
                position: 'left'
            }
        ];

        // Initialize app
        function initApp() {
            renderAreas();
            
            // Show tutorial on first visit
            setTimeout(() => {
                if (!appData.tutorialCompleted) {
                    const showTutorial = confirm('👋 ¿Es tu primera vez?\n\n¿Quieres ver el tutorial rápido?');
                    if (showTutorial) {
                        startTutorial();
                    } else {
                        appData.tutorialCompleted = true;
                    }
                }
            }, 1000);
        }

        // Render areas
        function renderAreas() {
            const grid = document.getElementById('areasGrid');
            grid.innerHTML = '';
            
            appData.areas.forEach((area, index) => {
                const card = document.createElement('div');
                card.className = 'area-card';
                card.style.setProperty('--color', area.color);
                card.innerHTML = `
                    <div class="area-icon">${area.icon}</div>
                    <div class="area-title">${area.title}</div>
                    <div style="color: #94A3B8; font-size: 0.9rem; margin-top: 5px;">${area.description}</div>
                    <div class="area-level">
                        <div class="level-bar">
                            <div class="level-fill" style="width: ${area.level}%; background: ${area.color};"></div>
                        </div>
                        <span style="color: ${area.color}; font-weight: 600;">${area.level}%</span>
                    </div>
                    <div class="level-adjuster">
                        <button class="level-btn" data-index="${index}" data-delta="-5" style="--color: ${area.color};">-5</button>
                        <button class="level-btn" data-index="${index}" data-delta="5" style="--color: ${area.color};">+5</button>
                    </div>
                `;
                
                // Add event listeners to level buttons
                const levelButtons = card.querySelectorAll('.level-btn');
                levelButtons.forEach(btn => {
                    btn.addEventListener('click', (e) => {
                        e.stopPropagation();
                        const idx = parseInt(btn.getAttribute('data-index'));
                        const delta = parseInt(btn.getAttribute('data-delta'));
                        adjustLevel(idx, delta);
                    });
                });
                
                // Add click event to card
                card.addEventListener('click', () => {
                    card.classList.toggle('active');
                });
                
                grid.appendChild(card);
            });
        }

        // Adjust area level
        function adjustLevel(index, delta) {
            appData.areas[index].level = Math.max(0, Math.min(100, appData.areas[index].level + delta));
            renderAreas();
            if (document.getElementById('statsModal').classList.contains('active')) {
                renderStats();
            }
        }

        // Quick fill
        function fillQuick(text) {
            document.getElementById('userInput').value = text;
        }

        // Analyze input
        function analyzeInput() {
            const input = document.getElementById('userInput').value.trim();
            if (!input) {
                alert('Por favor, escribe algo para analizar');
                return;
            }

            const analysis = generateAnalysis(input);
            displayResults(analysis);
        }

        // Generate analysis
        function generateAnalysis(input) {
            const lowerInput = input.toLowerCase();
            
            let affectedAreas = [];
            let coherenceLevel = 0;
            let diagnosis = '';
            let command = '';
            let actions = [];
            let verification = '';

            if (lowerInput.includes('ansi') || lowerInput.includes('estrés') || lowerInput.includes('agobiad')) {
                affectedAreas = ['health', 'spiritual', 'recreation'];
                coherenceLevel = 40;
                diagnosis = 'Detectado: Sistema nervioso activado, desalineación mente-cuerpo, necesidad de regulación inmediata.';
                command = 'COMANDO PRIORITARIO: Activar protocolo de regulación nerviosa. Respiración consciente → Movimiento suave → Reconexión con el momento presente.';
                actions = [
                    { area: 'health', text: 'Check corporal: ¿Qué necesita tu cuerpo HOY? Dáselo', color: '#10B981' },
                    { area: 'career', text: 'Definir "victoria del día": ¿Cuál es la UNA cosa que si logro, haré que hoy valga la pena?', color: '#3B82F6' }
                ];
                verification = 'Sabrás que funcionó cuando: al final del día puedas decir "hice lo importante", sientas satisfacción y estés en paz con lo pendiente.';
            }
            else {
                affectedAreas = ['spiritual', 'health', 'study'];
                coherenceLevel = 55;
                diagnosis = 'Detectado: Búsqueda de claridad general. Sistema disponible para optimización global.';
                command = 'COMANDO PRIORITARIO: Escaneo completo del sistema. Identificar área de mayor desbalance → Aplicar micro-ajuste inmediato.';
                actions = [
                    { area: 'spiritual', text: 'Revisar cada área del 1-10: ¿Cuál tiene el número más bajo? Esa es tu prioridad', color: '#8B5CF6' },
                    { area: 'health', text: 'Protocolo básico: 20 min movimiento + 7h sueño + hidratación', color: '#10B981' },
                    { area: 'study', text: 'Leer 15 min algo que te expanda (libro, podcast, conversación)', color: '#06B6D4' }
                ];
                verification = 'Sabrás que funcionó cuando: identifiques tu mayor palanca de cambio, hayas dado un paso concreto y sientas momentum renovado.';
            }

            return { affectedAreas, coherenceLevel, diagnosis, command, actions, verification };
        }

        // Display results
        function displayResults(analysis) {
            document.getElementById('commandText').textContent = analysis.command;
            document.getElementById('diagnosisText').textContent = analysis.diagnosis;
            document.getElementById('verificationText').textContent = analysis.verification;

            const actionsList = document.getElementById('actionsList');
            actionsList.innerHTML = '';
            analysis.actions.forEach(action => {
                const li = document.createElement('li');
                li.style.setProperty('--color', action.color);
                
                const area = appData.areas.find(a => a.color === action.color);
                const commands = [
                    ...(appData.verbalCommands[area.id] || []),
                    ...(appData.customCommands[area.id] || [])
                ];
                const randomCommand = commands.length > 0 ? commands[Math.floor(Math.random() * commands.length)] : null;
                
                li.innerHTML = `
                    <div style="flex: 1;">
                        ${action.text}
                        ${randomCommand ? `
                            <div style="margin-top: 10px; padding: 10px; background: rgba(0,0,0,0.2); border-radius: 6px; font-size: 0.95rem; font-style: italic; color: #CBD5E1;">
                                <strong style="color: ${action.color};">🗣️ Comando verbal:</strong><br>
                                "${randomCommand}"
                                <button class="speak-action-btn" data-cmd="${randomCommand.replace(/"/g, '&quot;')}" style="margin-top: 8px; padding: 6px 12px; background: ${action.color}; color: white; border: none; border-radius: 5px; cursor: pointer; font-size: 0.85rem;">🔊 Pronunciar</button>
                            </div>
                        ` : ''}
                    </div>
                `;
                actionsList.appendChild(li);
            });
            
            // Add event listeners to speak buttons
            document.querySelectorAll('.speak-action-btn').forEach(btn => {
                btn.addEventListener('click', () => {
                    const cmd = btn.getAttribute('data-cmd');
                    speakCommand(cmd);
                });
            });

            const coherenceCircle = document.getElementById('coherenceCircle');
            const coherenceText = document.getElementById('coherenceText');
            coherenceCircle.style.setProperty('--percentage', `${analysis.coherenceLevel}%`);
            
            let color, message;
            if (analysis.coherenceLevel < 40) {
                color = '#EF4444';
                message = 'Prioridad ALTA: Requiere atención inmediata';
            } else if (analysis.coherenceLevel < 70) {
                color = '#F59E0B';
                message = 'Optimización recomendada: Área de oportunidad';
            } else {
                color = '#10B981';
                message = 'Estado funcional: Mantenimiento ligero';
            }
            
            coherenceCircle.style.setProperty('--color', color);
            coherenceCircle.innerHTML = `<span>${analysis.coherenceLevel}%</span>`;
            coherenceText.textContent = message;

            document.querySelectorAll('.area-card').forEach((card, index) => {
                card.classList.remove('active');
                if (analysis.affectedAreas.includes(appData.areas[index].id)) {
                    card.classList.add('active');
                }
            });

            const resultsSection = document.getElementById('resultsSection');
            resultsSection.classList.add('active');
            resultsSection.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
        }

        // Meditation
        let meditationInterval = null;

        function openMeditation() {
            document.getElementById('meditationModal').classList.add('active');
            startMeditationCycle();
        }

        function closeMeditation() {
            document.getElementById('meditationModal').classList.remove('active');
            if (meditationInterval) {
                clearTimeout(meditationInterval);
                meditationInterval = null;
            }
        }

        function startMeditationCycle() {
            const phases = [
                { text: 'Inhala profundamente por la nariz...', duration: 4000, scale: 1.4 },
                { text: 'Sostén el aire suavemente...', duration: 7000, scale: 1.4 },
                { text: 'Exhala lentamente por la boca...', duration: 8000, scale: 1 },
                { text: 'Pausa natural...', duration: 2000, scale: 1 }
            ];
            
            let phaseIndex = 0;
            
            function nextPhase() {
                if (!document.getElementById('meditationModal').classList.contains('active')) return;
                
                const phase = phases[phaseIndex];
                document.getElementById('meditationPhase').textContent = phase.text;
                document.getElementById('breathCircle').style.transform = `scale(${phase.scale})`;
                
                phaseIndex = (phaseIndex + 1) % phases.length;
                meditationInterval = setTimeout(nextPhase, phase.duration);
            }
            
            nextPhase();
        }

        // Journal
        function openJournal() {
            document.getElementById('journalModal').classList.add('active');
        }

        function closeJournal() {
            document.getElementById('journalModal').classList.remove('active');
        }

        function saveJournal() {
            const gratitude = document.getElementById('gratitude').value;
            const learning = document.getElementById('learning').value;
            const intention = document.getElementById('intention').value;
            
            if (gratitude || learning || intention) {
                const entry = {
                    date: new Date().toISOString(),
                    gratitude,
                    learning,
                    intention
                };
                
                appData.journalEntries.push(entry);
                
                alert('✅ Entrada guardada\n\n"Lo que reconoces, crece."');
                
                document.getElementById('gratitude').value = '';
                document.getElementById('learning').value = '';
                document.getElementById('intention').value = '';
                
                closeJournal();
            } else {
                alert('Escribe al menos en uno de los campos.');
            }
        }

        // Stats
        function openStats() {
            document.getElementById('statsModal').classList.add('active');
            renderStats();
        }

        function closeStats() {
            document.getElementById('statsModal').classList.remove('active');
        }

        function renderStats() {
            const avgCoherence = Math.round(appData.areas.reduce((sum, a) => sum + a.level, 0) / appData.areas.length);
            const highestArea = appData.areas.reduce((max, a) => a.level > max.level ? a : max);
            const lowestArea = appData.areas.reduce((min, a) => a.level < min.level ? a : min);
            
            const statsGrid = document.getElementById('statsGrid');
            statsGrid.innerHTML = `
                <div class="stat-card" style="--color: #8B5CF6;">
                    <div class="stat-label">Coherencia Promedio</div>
                    <div class="stat-value">${avgCoherence}%</div>
                </div>
                
                <div class="stat-card" style="--color: #10B981;">
                    <div class="stat-label">Área más fuerte</div>
                    <div style="color: #10B981; font-size: 1.2rem; font-weight: bold; margin-top: 5px;">${highestArea.icon} ${highestArea.title}</div>
                    <div class="stat-value" style="font-size: 1.5rem; margin-top: 5px;">${highestArea.level}%</div>
                </div>
                
                <div class="stat-card" style="--color: #F59E0B;">
                    <div class="stat-label">Necesita atención</div>
                    <div style="color: #F59E0B; font-size: 1.2rem; font-weight: bold; margin-top: 5px;">${lowestArea.icon} ${lowestArea.title}</div>
                    <div class="stat-value" style="font-size: 1.5rem; margin-top: 5px;">${lowestArea.level}%</div>
                </div>
            `;
            
            const recommendation = document.getElementById('recommendation');
            recommendation.innerHTML = `
                Basado en tu perfil actual, tu mayor palanca de transformación está en <strong style="color: ${lowestArea.color};">${lowestArea.title}</strong>. 
                Un incremento del 10% en esta área elevará tu coherencia general en un 5-8%. 
                <br><br>
                <strong>Acción micro hoy:</strong> Dedica 15 minutos exclusivos a ${lowestArea.description.toLowerCase()}.
            `;
        }

        // Reminders
        function openReminders() {
            document.getElementById('remindersModal').classList.add('active');
            renderReminders();
        }

        function closeReminders() {
            document.getElementById('remindersModal').classList.remove('active');
        }

        function addReminder() {
            const time = document.getElementById('reminderTime').value;
            const text = document.getElementById('reminderText').value.trim();
            
            if (!text) {
                alert('Por favor escribe un texto');
                return;
            }
            
            appData.reminders.push({ time, text, id: Date.now() });
            document.getElementById('reminderText').value = '';
            renderReminders();
        }

        function deleteReminder(id) {
            appData.reminders = appData.reminders.filter(r => r.id !== id);
            renderReminders();
        }

        function renderReminders() {
            const list = document.getElementById('reminderList');
            
            if (appData.reminders.length === 0) {
                list.innerHTML = '<li style="padding: 20px; text-align: center; color: #94A3B8;">No hay recordatorios.</li>';
                return;
            }
            
            list.innerHTML = appData.reminders.map(r => `
                <li class="reminder-item">
                    <div>
                        <strong style="color: #A78BFA;">${r.time}</strong> - ${r.text}
                    </div>
                    <button class="reminder-delete" data-id="${r.id}">Eliminar</button>
                </li>
            `).join('');
            
            // Add event listeners
            document.querySelectorAll('.reminder-delete').forEach(btn => {
                btn.addEventListener('click', () => {
                    const id = parseInt(btn.getAttribute('data-id'));
                    deleteReminder(id);
                });
            });
        }

        // Affirmations
        function openAffirmations() {
            document.getElementById('affirmationsModal').classList.add('active');
            renderAffirmations();
        }

        function closeAffirmations() {
            document.getElementById('affirmationsModal').classList.remove('active');
        }

        function renderAffirmations() {
            const grid = document.getElementById('affirmationsGrid');
            grid.innerHTML = '';

            appData.areas.forEach(area => {
                const commands = [
                    ...(appData.verbalCommands[area.id] || []),
                    ...(appData.customCommands[area.id] || [])
                ];

                if (commands.length === 0) return;

                const card = document.createElement('div');
                card.style.cssText = `
                    background: rgba(15, 23, 42, 0.6);
                    padding: 20px;
                    border-radius: 12px;
                    border-left: 4px solid ${area.color};
                `;

                card.innerHTML = `
                    <h4 style="color: ${area.color}; margin-bottom: 15px; display: flex; align-items: center; gap: 10px;">
                        <span style="font-size: 1.5rem;">${area.icon}</span>
                        <span>${area.title}</span>
                    </h4>
                    ${commands.map((cmd, idx) => {
                        const isCustom = idx >= 3;
                        const cmdId = `cmd-${area.id}-${idx}`;
                        return `
                        <div style="background: rgba(30, 41, 59, 0.8); padding: 15px; border-radius: 8px; margin-bottom: 12px;">
                            <p style="color: #E2E8F0; line-height: 1.6; margin-bottom: 10px; font-size: 1.05rem;">"${cmd}"</p>
                            <div style="display: flex; gap: 10px; flex-wrap: wrap;">
                                <button id="speak-${cmdId}" data-text="${cmd.replace(/"/g, '&quot;')}" style="flex: 1; min-width: 120px; padding: 8px 15px; background: linear-gradient(135deg, ${area.color}, ${area.color}dd); color: white; border: none; border-radius: 6px; cursor: pointer; font-size: 0.9rem;">
                                    🔊 Pronunciar
                                </button>
                                <button id="copy-${cmdId}" data-text="${cmd.replace(/"/g, '&quot;')}" style="padding: 8px 15px; background: rgba(79, 70, 229, 0.2); border: 2px solid ${area.color}; color: ${area.color}; border-radius: 6px; cursor: pointer; font-size: 0.9rem;">
                                    📋 Copiar
                                </button>
                                ${isCustom ? `<button id="delete-${cmdId}" data-area="${area.id}" data-idx="${idx - 3}" style="padding: 8px 15px; background: rgba(239, 68, 68, 0.2); border: 2px solid #EF4444; color: #EF4444; border-radius: 6px; cursor: pointer; font-size: 0.9rem;">🗑️</button>` : ''}
                            </div>
                        </div>
                    `}).join('')}
                `;

                grid.appendChild(card);
                
                // Add event listeners
                commands.forEach((cmd, idx) => {
                    const cmdId = `cmd-${area.id}-${idx}`;
                    const isCustom = idx >= 3;
                    
                    const speakBtn = document.getElementById(`speak-${cmdId}`);
                    const copyBtn = document.getElementById(`copy-${cmdId}`);
                    
                    if (speakBtn) {
                        speakBtn.addEventListener('click', () => speakCommand(cmd));
                    }
                    
                    if (copyBtn) {
                        copyBtn.addEventListener('click', () => copyCommand(cmd));
                    }
                    
                    if (isCustom) {
                        const deleteBtn = document.getElementById(`delete-${cmdId}`);
                        if (deleteBtn) {
                            deleteBtn.addEventListener('click', () => deleteCustomCommand(area.id, idx - 3));
                        }
                    }
                });
            });
        }

        function speakCommand(text) {
            if ('speechSynthesis' in window) {
                window.speechSynthesis.cancel();
                
                const utterance = new SpeechSynthesisUtterance(text);
                utterance.lang = 'es-ES';
                utterance.rate = 0.9;
                utterance.pitch = 1.0;
                utterance.volume = 1.0;
                
                window.speechSynthesis.speak(utterance);
                
                showNotification('🔊 Pronunciando comando...', 'info');
            } else {
                alert('Tu navegador no soporta síntesis de voz.');
            }
        }

        function copyCommand(text) {
            navigator.clipboard.writeText(text).then(() => {
                showNotification('✓ Comando copiado', 'success');
            }).catch(() => {
                alert('No se pudo copiar.');
            });
        }

        function addCustomCommand() {
            const area = document.getElementById('customCommandArea').value;
            const text = document.getElementById('customCommandText').value.trim();
            
            if (!text) {
                alert('Por favor escribe un comando');
                return;
            }
            
            if (!appData.customCommands[area]) {
                appData.customCommands[area] = [];
            }
            
            appData.customCommands[area].push(text);
            document.getElementById('customCommandText').value = '';
            renderAffirmations();
            showNotification('✓ Comando agregado', 'success');
        }

        function deleteCustomCommand(areaId, index) {
            if (confirm('¿Eliminar este comando?')) {
                appData.customCommands[areaId].splice(index, 1);
                renderAffirmations();
            }
        }

        function showNotification(text, type) {
            const colors = {
                info: 'linear-gradient(135deg, #4F46E5, #8B5CF6)',
                success: 'linear-gradient(135deg, #10B981, #059669)',
                error: 'linear-gradient(135deg, #EF4444, #DC2626)'
            };
            
            const notification = document.createElement('div');
            notification.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                background: ${colors[type] || colors.info};
                color: white;
                padding: 15px 25px;
                border-radius: 10px;
                font-size: 1rem;
                z-index: 10000;
                box-shadow: 0 5px 20px rgba(0, 0, 0, 0.3);
                animation: fadeIn 0.3s ease;
            `;
            notification.textContent = text;
            document.body.appendChild(notification);
            
            setTimeout(() => {
                notification.style.animation = 'fadeOut 0.3s ease';
                setTimeout(() => notification.remove(), 300);
            }, 2000);
        }

        // Theme toggle
        function toggleTheme() {
            const body = document.body;
            const toggle = document.querySelector('.theme-toggle');
            
            if (body.classList.contains('light-mode')) {
                body.classList.remove('light-mode');
                toggle.textContent = '🌙';
                appData.theme = 'dark';
            } else {
                body.classList.add('light-mode');
                toggle.textContent = '☀️';
                appData.theme = 'light';
            }
        }

        // Tutorial Functions
        function startTutorial() {
            appData.currentTutorialStep = 0;
            document.getElementById('tutorialModal').classList.add('active');
            renderTutorialStep();
        }

        function closeTutorial() {
            document.getElementById('tutorialModal').classList.remove('active');
            appData.tutorialCompleted = true;
        }

        function nextTutorialStep() {
            if (appData.currentTutorialStep < tutorialSteps.length - 1) {
                appData.currentTutorialStep++;
                renderTutorialStep();
            } else {
                closeTutorial();
                setTimeout(() => {
                    if (confirm('¿Quieres un recorrido visual interactivo?')) {
                        startInteractiveTutorial();
                    }
                }, 500);
            }
        }

        function prevTutorialStep() {
            if (appData.currentTutorialStep > 0) {
                appData.currentTutorialStep--;
                renderTutorialStep();
            }
        }

        function renderTutorialStep() {
            const step = tutorialSteps[appData.currentTutorialStep];
            const content = document.getElementById('tutorialContent');
            
            content.innerHTML = `
                <h2 style="color: #A78BFA; font-size: 2rem; margin-bottom: 20px; text-align: center;">
                    ${step.title}
                </h2>
                ${step.content}
            `;

            const prevBtn = document.getElementById('tutorialPrev');
            const nextBtn = document.getElementById('tutorialNext');
            
            prevBtn.style.display = appData.currentTutorialStep === 0 ? 'none' : 'block';
            nextBtn.textContent = appData.currentTutorialStep === tutorialSteps.length - 1 ? '✓ Finalizar' : 'Siguiente →';

            const progress = document.getElementById('tutorialProgress');
            progress.textContent = `Paso ${appData.currentTutorialStep + 1} de ${tutorialSteps.length}`;
        }

        // Interactive Tutorial
        let currentInteractiveStep = 0;

        function startInteractiveTutorial() {
            currentInteractiveStep = 0;
            showInteractiveStep();
        }

        function showInteractiveStep() {
            if (currentInteractiveStep >= interactiveTutorialSteps.length) {
                closeInteractiveTutorial();
                return;
            }

            const step = interactiveTutorialSteps[currentInteractiveStep];
            const overlay = document.getElementById('tutorialOverlay');
            const highlight = document.getElementById('tutorialHighlight');
            const tooltip = document.getElementById('tutorialTooltip');
            const tooltipContent = document.getElementById('tutorialTooltipContent');

            overlay.classList.add('active');

            const target = document.querySelector(step.target);
            if (!target) {
                nextInteractiveTutorial();
                return;
            }

            const rect = target.getBoundingClientRect();
            highlight.style.left = rect.left - 10 + 'px';
            highlight.style.top = rect.top - 10 + 'px';
            highlight.style.width = rect.width + 20 + 'px';
            highlight.style.height = rect.height + 20 + 'px';

            tooltipContent.innerHTML = `
                <h3 style="color: #F59E0B; margin-bottom: 10px; font-size: 1.2rem;">${step.title}</h3>
                <p style="margin: 0;">${step.content}</p>
            `;

            let tooltipTop, tooltipLeft;
            
            switch(step.position) {
                case 'bottom':
                    tooltipTop = rect.bottom + 20;
                    tooltipLeft = rect.left + (rect.width / 2) - 200;
                    break;
                case 'top':
                    tooltipTop = rect.top - 200;
                    tooltipLeft = rect.left + (rect.width / 2) - 200;
                    break;
                case 'left':
                    tooltipTop = rect.top + (rect.height / 2) - 100;
                    tooltipLeft = rect.left - 420;
                    break;
                default:
                    tooltipTop = rect.bottom + 20;
                    tooltipLeft = rect.left;
            }

            tooltip.style.top = Math.max(20, tooltipTop) + 'px';
            tooltip.style.left = Math.max(20, Math.min(window.innerWidth - 420, tooltipLeft)) + 'px';
        }

        function nextInteractiveTutorial() {
            currentInteractiveStep++;
            showInteractiveStep();
        }

        function skipTutorial() {
            closeInteractiveTutorial();
        }

        function closeInteractiveTutorial() {
            document.getElementById('tutorialOverlay').classList.remove('active');
            currentInteractiveStep = 0;
        }

        // Initialize
        initApp();
        
        // Setup all event listeners after DOM is ready
        setTimeout(() => {
            // Theme toggle
            const themeToggle = document.getElementById('themeToggle');
            if (themeToggle) themeToggle.addEventListener('click', toggleTheme);
            
            // Tutorial button
            const tutorialBtn = document.getElementById('tutorialBtn');
            if (tutorialBtn) tutorialBtn.addEventListener('click', startTutorial);
            
            // Analyze button
            const analyzeBtn = document.getElementById('analyzeBtn');
            if (analyzeBtn) analyzeBtn.addEventListener('click', analyzeInput);
            
            // Quick action buttons
            document.querySelectorAll('.quick-btn').forEach(btn => {
                btn.addEventListener('click', () => {
                    const text = btn.getAttribute('data-text');
                    fillQuick(text);
                });
            });
            
            // Tool panel buttons
            const meditationBtn = document.getElementById('meditationBtn');
            if (meditationBtn) meditationBtn.addEventListener('click', openMeditation);
            
            const journalBtn = document.getElementById('journalBtn');
            if (journalBtn) journalBtn.addEventListener('click', openJournal);
            
            const statsBtn = document.getElementById('statsBtn');
            if (statsBtn) statsBtn.addEventListener('click', openStats);
            
            const remindersBtn = document.getElementById('remindersBtn');
            if (remindersBtn) remindersBtn.addEventListener('click', openReminders);
            
            const commandsBtn = document.getElementById('commandsBtn');
            if (commandsBtn) commandsBtn.addEventListener('click', openAffirmations);
            
            // Modal close buttons
            const closeMeditationBtn = document.getElementById('closeMeditationBtn');
            if (closeMeditationBtn) closeMeditationBtn.addEventListener('click', closeMeditation);
            
            const saveJournalBtn = document.getElementById('saveJournalBtn');
            if (saveJournalBtn) saveJournalBtn.addEventListener('click', saveJournal);
            
            const closeJournalBtn = document.getElementById('closeJournalBtn');
            if (closeJournalBtn) closeJournalBtn.addEventListener('click', closeJournal);
            
            const closeStatsBtn = document.getElementById('closeStatsBtn');
            if (closeStatsBtn) closeStatsBtn.addEventListener('click', closeStats);
            
            const addReminderBtn = document.getElementById('addReminderBtn');
            if (addReminderBtn) addReminderBtn.addEventListener('click', addReminder);
            
            const closeRemindersBtn = document.getElementById('closeRemindersBtn');
            if (closeRemindersBtn) closeRemindersBtn.addEventListener('click', closeReminders);
            
            const addCustomCommandBtn = document.getElementById('addCustomCommandBtn');
            if (addCustomCommandBtn) addCustomCommandBtn.addEventListener('click', addCustomCommand);
            
            const closeAffirmationsBtn = document.getElementById('closeAffirmationsBtn');
            if (closeAffirmationsBtn) closeAffirmationsBtn.addEventListener('click', closeAffirmations);
            
            // Tutorial navigation
            const tutorialNext = document.getElementById('tutorialNext');
            if (tutorialNext) tutorialNext.addEventListener('click', nextTutorialStep);
            
            const tutorialPrev = document.getElementById('tutorialPrev');
            if (tutorialPrev) tutorialPrev.addEventListener('click', prevTutorialStep);
            
            const closeTutorialBtn = document.getElementById('closeTutorialBtn');
            if (closeTutorialBtn) closeTutorialBtn.addEventListener('click', closeTutorial);
            
            // Interactive tutorial buttons
            const skipBtn = document.getElementById('skipTutorialBtn');
            if (skipBtn) skipBtn.addEventListener('click', skipTutorial);
            
            const nextBtn = document.getElementById('nextTutorialBtn');
            if (nextBtn) nextBtn.addEventListener('click', nextInteractiveTutorial);
        }, 100);
    </script>
</body>
</html>', text: 'Ejecutar 5 respiraciones profundas (4-7-8): inhala 4 seg, sostén 7 seg, exhala 8 seg', color: '#10B981' },
                    { area: 'spiritual', text: 'Anclar atención en el ahora: nombrar 3 cosas que ves, 2 que sientes físicamente, 1 que escuchas', color: '#8B5CF6' },
                    { area: 'recreation', text: 'Pausar 10 minutos sin pantallas: caminar, estirarte o cerrar ojos', color: '#EC4899' }
                ];
                verification = 'Sabrás que funcionó cuando: tu respiración se vuelva más lenta y profunda naturalmente, sientas tus pies firmemente en el suelo, y puedas identificar una prioridad clara para las próximas 2 horas.';
            }
            else if (lowerInput.includes('disperso') || lowerInput.includes('sin dirección') || lowerInput.includes('perdid')) {
                affectedAreas = ['spiritual', 'career', 'study'];
                coherenceLevel = 35;
                diagnosis = 'Detectado: Desconexión con propósito central, energía fragmentada en múltiples direcciones sin jerarquía clara.';
                command = 'COMANDO PRIORITARIO: Restablecer claridad de propósito. Pregunta central → Eliminar lo no esencial → Definir siguiente acción concreta.';
                actions = [
                    { area: 'spiritual', text: 'Responder por escrito: "Si solo pudiera lograr UNA cosa esta semana que me haga sentir alineado, ¿cuál sería?"', color: '#8B5CF6' },
                    { area: 'career', text: 'Identificar las 3 tareas que realmente mueven la aguja en tu trabajo. Eliminar o delegar el resto', color: '#3B82F6' },
                    { area: 'study', text: 'Elegir UN tema de aprendizaje por 21 días. Desactivar todas las demás notificaciones', color: '#06B6D4' }
                ];
                verification = 'Sabrás que funcionó cuando: puedas decir en una frase qué es lo más importante ahora, sientas alivio al decir "no" a lo secundario, y tengas una acción física agendada para hoy.';
            }
            else if (lowerInput.includes('decisión') || lowerInput.includes('decidir') || lowerInput.includes('elección')) {
                affectedAreas = ['spiritual', 'career', 'family'];
                coherenceLevel = 50;
                diagnosis = 'Detectado: Momento de bifurcación. Necesidad de alinear valores profundos con elección práctica.';
                command = 'COMANDO PRIORITARIO: Activar claridad decisional. Conectar con valores → Proyectar escenarios → Sentir la respuesta corporal.';
                actions = [
                    { area: 'spiritual', text: 'Escribir: "Mis 3 valores no negociables son..." y verificar qué opción los honra mejor', color: '#8B5CF6' },
                    { area: 'career', text: 'Visualizar: ¿Cómo me siento dentro de 1 año con cada opción? Nota las sensaciones físicas', color: '#3B82F6' },
                    { area: 'family', text: 'Consultar: ¿Esta decisión fortalece o debilita mis vínculos importantes?', color: '#F59E0B' }
                ];
                verification = 'Sabrás que funcionó cuando: sientas claridad visceral (no solo mental), puedas explicar tu decisión en 2 frases simples, y experimentes paz corporal.';
            }
            else if (lowerInput.includes('energía') || lowerInput.includes('cansad') || lowerInput.includes('agotad')) {
                affectedAreas = ['health', 'recreation', 'home'];
                coherenceLevel = 30;
                diagnosis = 'Detectado: Batería vital baja. Desequilibrio entre gasto y recuperación energética.';
                command = 'COMANDO PRIORITARIO: Restaurar reservas vitales. Descanso de calidad → Nutrición consciente → Eliminar vampiros energéticos.';
                actions = [
                    { area: 'health', text: 'Hoy: dormir 30 minutos extra, hidratación (2L agua), comida con proteína y vegetales verdes', color: '#10B981' },
                    { area: 'recreation', text: 'Agendar 1 hora esta semana SOLO para ti, sin obligaciones. No negociable', color: '#EC4899' },
                    { area: 'home', text: 'Identificar 3 "vampiros energéticos" (desorden, tareas pendientes) y eliminar UNO hoy', color: '#84CC16' }
                ];
                verification = 'Sabrás que funcionó cuando: puedas completar una tarea sin esfuerzo excesivo, tu cuerpo pida menos estimulantes, y sientas curiosidad natural.';
            }
            else if (lowerInput.includes('atender hoy') || lowerInput.includes('prioridad')) {
                affectedAreas = ['spiritual', 'health', 'career'];
                coherenceLevel = 60;
                diagnosis = 'Detectado: Búsqueda de orientación diaria. Sistema listo para recibir instrucciones de alto nivel.';
                command = 'COMANDO PRIORITARIO: Establecer intención clara para las próximas 24h. Alinear con energía disponible → Definir victoria del día.';
                actions = [
                    { area: 'spiritual', text: 'Pregunta matutina: "¿Qué versión de mí quiero ser hoy?" Elige 3 cualidades', color: '#8B5CF6' },
                    { area: 'health