<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover,user-scalable=no" />
  <title>Mi Sistema de Vida</title>
  <meta name="theme-color" content="#007BFF" />
  <style>
    :root{
      --bg:#ffffff;
      --card:#f2f8ff;
      --accent:#007BFF;
      --text:#06243a;
      --muted:#6b7d8b;
      --radius:14px;
    }
    [data-theme="dark"]{
      --bg:#061426;
      --card:#07172a;
      --accent:#66b7ff;
      --text:#eaf6ff;
      --muted:#9fb9d6;
    }
    *{box-sizing:border-box}
    html,body{height:100%;margin:0;background:var(--bg);color:var(--text);font-family:Inter, system-ui, -apple-system, 'Segoe UI', Roboto, Arial}
    .app{max-width:920px;margin:0 auto;padding:18px}
    header{display:flex;gap:12px;align-items:center;justify-content:space-between}
    h1{font-size:1.1rem;margin:0}
    p.lead{margin:6px 0 12px;color:var(--muted);font-size:0.95rem}
    .controls{display:flex;gap:8px;align-items:center}
    .btn{background:var(--accent);color:white;padding:8px 12px;border-radius:10px;border:0;cursor:pointer;font-weight:600}
    .ghost{background:transparent;color:var(--accent);border:1px solid var(--accent);padding:8px 10px;border-radius:10px}
    nav.grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(160px,1fr));gap:12px;margin-top:14px}
    .card{background:var(--card);border-radius:var(--radius);padding:12px;min-height:100px;display:flex;flex-direction:column;justify-content:space-between;box-shadow:0 6px 18px rgba(11,20,30,0.06)}
    .card h3{margin:0;font-size:1rem}
    .card p{margin:6px 0 0;color:var(--muted);font-size:0.9rem}
    footer{margin-top:18px;color:var(--muted);font-size:0.85rem}
    .modal-back{position:fixed;inset:0;background:rgba(2,8,20,0.45);display:none;align-items:center;justify-content:center;padding:18px;z-index:50}
    .modal{background:var(--bg);border-radius:12px;padding:16px;max-width:560px;width:100%;box-shadow:0 18px 40px rgba(2,8,20,0.4)}
    .modal h2{margin:0 0 8px}
    .prompt{background:linear-gradient(90deg,var(--card),rgba(255,255,255,0.6));padding:12px;border-radius:10px;margin:8px 0;font-weight:600}
    .breaths{display:flex;gap:8px;margin-top:8px}
    .breath{flex:1;padding:8px;border-radius:8px;text-align:center;background:transparent;border:1px dashed var(--muted);color:var(--muted)}
    .copy{background:transparent;border:0;color:var(--accent);cursor:pointer;font-weight:700}
    .install-note{background:linear-gradient(90deg,#eaf4ff,white);padding:10px;border-radius:10px;border:1px solid #cfe8ff;color:var(--muted);display:flex;align-items:center;gap:10px}
    @media (max-width:520px){h1{font-size:1rem}.card{min-height:110px}}
  </style>
</head>
<body data-theme="light">
  <div class="app">
    <header>
      <div>
        <h1>Mi Sistema de Vida ‚Äî Panel de Comandos</h1>
        <p class="lead">Activa un programa con intenci√≥n: respira, copia/comprende el comando y ejecuta.</p>
      </div>
      <div class="controls">
        <button class="ghost" id="themeToggle">üîÅ Tema</button>
        <button class="btn" id="openGuide">Gu√≠a r√°pida</button>
      </div>
    </header>

    <div style="margin-top:12px" id="installArea">
      <div class="install-note" id="installNote">
        <div style="width:44px;height:44px;display:flex;align-items:center;justify-content:center;border-radius:8px;background:linear-gradient(180deg,#007BFF,#005fc7);color:white;font-weight:700">
          <!-- icon SVG small -->
          üß†
        </div>
        <div>
          <strong>Instala la app</strong><br>
          Agrega a pantalla de inicio para usarla como app. (Chrome: men√∫ ‚Üí A√±adir a pantalla de inicio)
        </div>
      </div>
    </div>

    <nav class="grid" id="programGrid"></nav>

    <footer>
      F√≥rmula r√°pida:
      <code style="background:#eef6ff;padding:4px 6px;border-radius:6px;margin-left:6px">"Conciencia, abrir programa [nombre]. Enfocar toda mi energ√≠a en [acci√≥n]."</code>
    </footer>
  </div>

  <div class="modal-back" id="modal">
    <div class="modal" role="dialog" aria-modal="true">
      <h2 id="modalTitle">Programa</h2>
      <div class="prompt" id="modalPrompt">Comando ejemplo</div>
      <div class="small" id="modalPurpose" style="color:var(--muted)"></div>
      <div class="breaths" style="margin-top:12px">
        <div class="breath" id="b1">Respira: 3 inhalaciones lentas</div>
        <div class="breath" id="b2">Exhala: suelta tensi√≥n</div>
      </div>
      <div style="display:flex;gap:8px;margin-top:12px;justify-content:space-between;align-items:center">
        <div style="color:var(--muted);font-size:0.9rem">¬øListo para activar?</div>
        <div>
          <button class="btn" id="copyBtn">Copiar comando</button>
          <button class="ghost" id="closeModal">Cerrar</button>
        </div>
      </div>
    </div>
  </div>

<script>
/* ---------- Programas (personalizados) ---------- */
const programs = [
  {key:'espiritual', icon:'üåü', title:'Espiritual', purpose:'Elevar la conexi√≥n interior y orar.', phrase:'Conciencia, abrir programa espiritual. Enfocar toda mi energ√≠a en orar y sentir conexi√≥n divina.'},
  {key:'cuerpo', icon:'üí™', title:'Cuerpo', purpose:'Activar salud, movimiento y cuidado f√≠sico.', phrase:'Conciencia, abrir programa cuerpo. Enfocar toda mi energ√≠a en cuidar mi cuerpo: movimiento, respiraci√≥n y nutrici√≥n.'},
  {key:'familia', icon:'üë®‚Äçüë©‚Äçüëß‚Äçüë¶', title:'Familia', purpose:'Conectar y compartir presencia con los seres queridos.', phrase:'Conciencia, abrir programa familia. Enfocar toda mi energ√≠a en escuchar y apoyar con amor.'},
  {key:'trabajo', icon:'üß∞', title:'Trabajo', purpose:'Actuar con eficiencia y responsabilidad profesional.', phrase:'Conciencia, abrir programa trabajo. Enfocar toda mi energ√≠a en cumplir mis tareas con atenci√≥n y orden.'},
  {key:'finanzas', icon:'üí∞', title:'Finanzas', purpose:'Ordenar y planificar recursos econ√≥micos.', phrase:'Conciencia, abrir programa finanzas. Enfocar toda mi energ√≠a en revisar y ordenar mis cuentas.'},
  {key:'estudio', icon:'üìö', title:'Estudio', purpose:'Aprender y asimilar conocimiento con profundidad.', phrase:'Conciencia, abrir programa estudio. Enfocar toda mi energ√≠a en este tema y en comprender profundamente.'},
  {key:'creacion', icon:'üé®', title:'Creaci√≥n', purpose:'Dar forma a ideas y proyectos creativos.', phrase:'Conciencia, abrir programa creaci√≥n. Enfocar toda mi energ√≠a en crear y materializar esta idea.'},
  {key:'casa', icon:'üè†', title:'Casa', purpose:'Ordenar, limpiar y armonizar el espacio f√≠sico.', phrase:'Conciencia, abrir programa casa. Enfocar toda mi energ√≠a en ordenar, limpiar y organizar.'},
  {key:'social', icon:'ü§ù', title:'Social', purpose:'Interactuar y compartir en comunidad.', phrase:'Conciencia, abrir programa social. Enfocar toda mi energ√≠a en conectar y disfrutar con otros.'},
  {key:'descanso', icon:'üí§', title:'Descanso', purpose:'Recuperar energ√≠a mediante sue√±o y pausa.', phrase:'Conciencia, abrir programa descanso. Enfocar toda mi energ√≠a en relajarme y regenerarme.'},
  {key:'pareja', icon:'‚ù§Ô∏è', title:'Pareja/Intimidad', purpose:'Conectar en intimidad y cari√±o con la pareja.', phrase:'Conciencia, abrir programa pareja. Enfocar toda mi energ√≠a en amar y conectar plenamente.'}
];

/* ---------- Render UI ---------- */
const grid = document.getElementById('programGrid');
programs.forEach(p=>{
  const el = document.createElement('article');
  el.className = 'card';
  el.innerHTML = `<div><h3>${p.icon} ${p.title}</h3><p class="small">${p.purpose}</p></div>
    <div style="display:flex;gap:8px;justify-content:space-between;align-items:center">
      <button class="btn" data-key="${p.key}">Abrir</button>
      <button class="ghost" data-preview="${p.key}">Ver</button>
    </div>`;
  grid.appendChild(el);
});

/* ---------- Modal logic ---------- */
const modal = document.getElementById('modal');
const modalTitle = document.getElementById('modalTitle');
const modalPrompt = document.getElementById('modalPrompt');
const modalPurpose = document.getElementById('modalPurpose');
const copyBtn = document.getElementById('copyBtn');

document.body.addEventListener('click', e=>{
  const key = e.target.getAttribute('data-preview');
  if(key){
    const p = programs.find(x=>x.key===key);
    openModal(p);
  }
  const openKey = e.target.getAttribute('data-key');
  if(openKey){
    const p = programs.find(x=>x.key===openKey);
    openModal(p);
  }
});

function openModal(p){
  modal.style.display = 'flex';
  modalTitle.textContent = `${p.icon} ${p.title}`;
  modalPrompt.textContent = p.phrase;
  modalPurpose.textContent = p.purpose;
  copyBtn.onclick = async ()=>{
    try{
      await navigator.clipboard.writeText(p.phrase);
      copyBtn.textContent = 'Copiado ‚úì';
      setTimeout(()=>copyBtn.textContent='Copiar comando',1200);
    }catch(err){
      alert('No se pudo copiar. Selecciona manualmente el texto.');
    }
  };
}
document.getElementById('closeModal').onclick = ()=> modal.style.display='none';
document.getElementById('modal').addEventListener('click', e=>{ if(e.target.id==='modal') modal.style.display='none'; });

/* ---------- Theme toggle ---------- */
document.getElementById('themeToggle').onclick = ()=>{
  const html = document.documentElement;
  const t = html.getAttribute('data-theme')==='dark' ? 'light':'dark';
  html.setAttribute('data-theme',t);
  localStorage.setItem('theme',t);
};
const saved = localStorage.getItem('theme'); if(saved) document.documentElement.setAttribute('data-theme',saved);
document.getElementById('openGuide').onclick = ()=> alert('Usa la f√≥rmula:\\n\"Conciencia, abrir programa [nombre]. Enfocar toda mi energ√≠a en [acci√≥n].\"\\n\\nRespira 3 veces y act√∫a.');

/* ---------- PWA manifest din√°mico + icon SVG dataURL ---------- */
const svgIcon = `<svg xmlns='http://www.w3.org/2000/svg' width='512' height='512' viewBox='0 0 64 64'>
  <rect width='64' height='64' rx='12' fill='#007BFF'/>
  <g transform='translate(8,10)' fill='none' stroke='#fff' stroke-width='1.8' stroke-linecap='round' stroke-linejoin='round'>
    <path d='M10 6c0-3.3 4-6 8-6s8 2.7 8 6c0 1.8-.7 3.4-1.9 4.6C23.9 17 22 21 22 21s-2.9 5-8 5-8-5-8-5-1.9-4-2.1-10C3.9 9.4 7 7.8 10 6z'/>
    <path d='M12 22s1-6 6-6 6 6 6 6'/>
    <path d='M6 12s3-6 10-6'/>
    <path d='M30 12s-3-6-10-6'/>
  </g>
</svg>`;
const svgBase64 = 'data:image/svg+xml;base64,' + btoa(svgIcon);

const manifest = {
  name: "Mi Sistema de Vida",
  short_name: "MiSistemaVida",
  description: "Panel de comandos para alinear conciencia, cuerpo y energ√≠a.",
  icons: [
    { src: svgBase64, sizes: "512x512", type: "image/svg+xml", purpose: "any maskable" }
  ],
  start_url: ".",
  display: "standalone",
  background_color: "#ffffff",
  theme_color: "#007BFF",
  orientation: "any"
};
const manifestBlob = new Blob([JSON.stringify(manifest)], {type: 'application/json'});
const manifestURL = URL.createObjectURL(manifestBlob);
const link = document.createElement('link');
link.rel = 'manifest';
link.href = manifestURL;
document.head.appendChild(link);

/* ---------- Install prompt handling ---------- */
let deferredPrompt = null;
window.addEventListener('beforeinstallprompt', (e)=>{
  e.preventDefault();
  deferredPrompt = e;
  showInstallHint();
});
function showInstallHint(){
  const area = document.getElementById('installArea');
  const note = document.getElementById('installNote');
  note.style.display = 'flex';
  note.onclick = async ()=>{
    if(deferredPrompt){
      deferredPrompt.prompt();
      const choice = await deferredPrompt.userChoice;
      deferredPrompt = null;
      note.style.display = 'none';
    } else {
      alert('Abre el men√∫ del navegador y elige "Agregar a pantalla de inicio".');
    }
  };
}

/* ---------- Service worker inline via blob ---------- */
const swCode = `
// service-worker (inline blob)
const CACHE_NAME = 'mi-sistema-vida-v1';
const OFFLINE_URL = '.';
self.addEventListener('install', event=>{
  event.waitUntil(caches.open(CACHE_NAME).then(cache=>{
    return cache.addAll([
      '.', // index (same document)
    ]);
  }));
  self.skipWaiting();
});
self.addEventListener('activate', event=>{
  event.waitUntil(self.clients.claim());
});
self.addEventListener('fetch', event=>{
  // Try network first, fallback to cache
  event.respondWith(fetch(event.request).catch(()=>caches.match(event.request)).then(resp=>{
    return resp || caches.match(OFFLINE_URL);
  }));
});
`;
const swBlob = new Blob([swCode], {type:'application/javascript'});
const swUrl = URL.createObjectURL(swBlob);
if('serviceWorker' in navigator){
  navigator.serviceWorker.register(swUrl).then(reg=>{
    console.log('Service worker registrado (desde blob):', reg.scope);
  }).catch(err=>{
    console.warn('No se pudo registrar el service worker:', err);
  });
}

/* ---------- Helpful tip: quick voice/internal command simulation ---------- */
/* Small helper to speak the command (optional) */
function speakText(text){
  if('speechSynthesis' in window){
    const msg = new SpeechSynthesisUtterance(text);
    msg.lang = 'es-ES';
    msg.rate = 1;
    window.speechSynthesis.cancel();
    window.speechSynthesis.speak(msg);
  }
}

/* Add long-press vocalize and quick actions */
document.addEventListener('dblclick', e=>{
  const el = e.target.closest('article.card');
  if(el){
    const key = el.querySelector('button[data-key]')?.getAttribute('data-key');
    const p = programs.find(x=>x.key===key);
    if(p) speakText(p.phrase);
  }
});
</script>

</body>
</html>